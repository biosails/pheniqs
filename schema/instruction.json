{
    "$ref": "#/definitions/instruction",
    "$schema": "http://json-schema.org/draft-04/schema#",
    "definitions": {
        "barcode_length": {
            "items": {
                "minimum": 0,
                "type": "integer"
            },
            "minItems": 1,
            "type": "array"
        },
        "barcode_sequence": {
            "items": {
                "format": "regex",
                "pattern": "^[ATCG=]+$",
                "type": "string"
            },
            "type": "array"
        },
        "buffer_capacity": {
            "minimum": 0,
            "type": "integer"
        },
        "buffer_resolution": {
            "minimum": 0,
            "type": "integer"
        },
        "codec_class": {
            "allOf": [
                {
                    "$ref": "#/definitions/rg"
                },
                {
                    "properties": {
                        "algorithm": {
                            "$ref": "#/definitions/decoding_algorithm"
                        },
                        "barcode": {
                            "$ref": "#/definitions/barcode_sequence"
                        },
                        "concentration": {
                            "$ref": "#/definitions/concentration"
                        },
                        "enable quality control": {
                            "$ref": "#/definitions/enable_quality_control"
                        },
                        "flowcell id": {
                            "$ref": "#/definitions/flowcell_id"
                        },
                        "flowcell lane number": {
                            "$ref": "#/definitions/flowcell_lane_number"
                        },
                        "include filtered": {
                            "$ref": "#/definitions/include_filtered"
                        },
                        "index": {
                            "$ref": "#/definitions/index"
                        },
                        "output": {
                            "$ref": "#/definitions/url_array"
                        },
                        "output feed by segment": {
                            "$ref": "#/definitions/feed_array"
                        },
                        "segment cardinality": {
                            "$ref": "#/definitions/segment_cardinality"
                        }
                    }
                }
            ],
            "type": "object"
        },
        "compile_only": {
            "type": "boolean"
        },
        "concentration": {
            "minimum": 0,
            "type": "number"
        },
        "confidence_threshold": {
            "maximum": 1,
            "minimum": 0,
            "type": "number"
        },
        "decoder": {
            "allOf": [
                {
                    "$ref": "#/definitions/rg"
                },
                {
                    "properties": {
                        "algorithm": {
                            "$ref": "#/definitions/decoding_algorithm"
                        },
                        "barcode length": {
                            "$ref": "#/definitions/barcode_length"
                        },
                        "base output url": {
                            "$ref": "#/definitions/url"
                        },
                        "codec": {
                            "additionalProperties": {
                                "$ref": "#/definitions/codec_class"
                            },
                            "type": "object"
                        },
                        "confidence threshold": {
                            "$ref": "#/definitions/confidence_threshold"
                        },
                        "distance tolerance": {
                            "$ref": "#/definitions/distance_tolerance"
                        },
                        "flowcell id": {
                            "$ref": "#/definitions/flowcell_id"
                        },
                        "flowcell lane number": {
                            "$ref": "#/definitions/flowcell_lane_number"
                        },
                        "index": {
                            "$ref": "#/definitions/index"
                        },
                        "noise": {
                            "$ref": "#/definitions/noise"
                        },
                        "nucleotide cardinality": {
                            "$ref": "#/definitions/nucleotide_cardinality"
                        },
                        "quality masking threshold": {
                            "$ref": "#/definitions/quality_masking_threshold"
                        },
                        "segment cardinality": {
                            "$ref": "#/definitions/segment_cardinality"
                        },
                        "shannon bound": {
                            "$ref": "#/definitions/shannon_bound"
                        },
                        "transform": {
                            "$ref": "#/definitions/transform"
                        },
                        "undetermined": {
                            "$ref": "#/definitions/codec_class"
                        }
                    }
                }
            ],
            "type": "object"
        },
        "decoder_group": {
            "oneOf": [
                {
                    "$ref": "#/definitions/decoder"
                },
                {
                    "items": {
                        "$ref": "#/definitions/decoder"
                    },
                    "type": "array"
                }
            ]
        },
        "decoding_algorithm": {
            "enum": [
                "uknown",
                "mdd",
                "pamld",
                "naive",
                "transparent"
            ],
            "type": "string"
        },
        "enable_quality_control": {
            "type": "boolean"
        },
        "distance_tolerance": {
            "items": {
                "minimum": 0,
                "type": "integer"
            },
            "type": "array"
        },
        "feed": {
            "properties": {
                "capacity": {
                    "$ref": "#/definitions/buffer_capacity"
                },
                "direction": {
                    "$ref": "#/definitions/io_direction"
                },
                "index": {
                    "$ref": "#/definitions/index"
                },
                "phred offset": {
                    "$ref": "#/definitions/phred_offset"
                },
                "platform": {
                    "$ref": "#/definitions/rg_pl"
                },
                "resolution": {
                    "$ref": "#/definitions/buffer_resolution"
                },
                "url": {
                    "$ref": "#/definitions/url"
                }
            },
            "type": "object"
        },
        "feed_array": {
            "items": {
                "$ref": "#/definitions/feed"
            },
            "minItems": 1,
            "type": "array"
        },
        "flowcell_id": {
            "type": "string"
        },
        "flowcell_lane_number": {
            "minimum": 0,
            "type": "integer"
        },
        "include_filtered": {
            "type": "boolean"
        },
        "index": {
            "minimum": 0,
            "type": "integer"
        },
        "instruction": {
            "properties": {
                "base input url": {
                    "$ref": "#/definitions/url"
                },
                "base output url": {
                    "$ref": "#/definitions/url"
                },
                "buffer capacity": {
                    "$ref": "#/definitions/buffer_capacity"
                },
                "cellular": {
                    "$ref": "#/definitions/decoder_group"
                },
                "compile only": {
                    "$ref": "#/definitions/compile_only"
                },
                "enable quality control": {
                    "$ref": "#/definitions/enable_quality_control"
                },
                "flowcell id": {
                    "$ref": "#/definitions/flowcell_id"
                },
                "flowcell lane number": {
                    "$ref": "#/definitions/flowcell_lane_number"
                },
                "include filtered": {
                    "$ref": "#/definitions/include_filtered"
                },
                "input": {
                    "$ref": "#/definitions/url_array"
                },
                "input feed": {
                    "$ref": "#/definitions/feed_array"
                },
                "input feed by segment": {
                    "$ref": "#/definitions/feed_array"
                },
                "input phred offset": {
                    "$ref": "#/definitions/phred_offset"
                },
                "input segment cardinality": {
                    "$ref": "#/definitions/segment_cardinality"
                },
                "leading segment index": {
                    "$ref": "#/definitions/leading_segment_index"
                },
                "multiplex": {
                    "$ref": "#/definitions/decoder"
                },
                "output": {
                    "$ref": "#/definitions/url_array"
                },
                "output feed": {
                    "$ref": "#/definitions/feed_array"
                },
                "output phred offset": {
                    "$ref": "#/definitions/phred_offset"
                },
                "output segment cardinality": {
                    "$ref": "#/definitions/segment_cardinality"
                },
                "program": {
                    "$ref": "#/definitions/pg"
                },
                "threads": {
                    "$ref": "#/definitions/threads"
                },
                "transform": {
                    "$ref": "#/definitions/transform"
                },
                "working directory": {
                    "$ref": "#/definitions/url"
                }
            },
            "type": "object"
        },
        "io_direction": {
            "enum": [
                "in",
                "out"
            ],
            "type": "string"
        },
        "leading_segment_index": {
            "minimum": 0,
            "type": "integer"
        },
        "noise": {
            "maximum": 1,
            "minimum": 0,
            "type": "number"
        },
        "nucleotide_cardinality": {
            "minimum": 0,
            "type": "integer"
        },
        "pg": {
            "CL": {
                "$ref": "#/definitions/pg_cl"
            },
            "ID": {
                "$ref": "#/definitions/pg_id"
            },
            "PN": {
                "$ref": "#/definitions/pg_pn"
            },
            "VN": {
                "$ref": "#/definitions/pg_vn"
            }
        },
        "pg_cl": {
            "type": "string"
        },
        "pg_id": {
            "type": "string"
        },
        "pg_pn": {
            "type": "string"
        },
        "pg_vn": {
            "type": "string"
        },
        "phred_offset": {
            "maximum": 128,
            "minimum": 0,
            "type": "integer"
        },
        "quality_masking_threshold": {
            "maximum": 128,
            "minimum": 0,
            "type": "integer"
        },
        "rg": {
            "properties": {
                "CN": {
                    "$ref": "#/definitions/rg_cn"
                },
                "DS": {
                    "$ref": "#/definitions/rg_ds"
                },
                "DT": {
                    "$ref": "#/definitions/rg_dt"
                },
                "FO": {
                    "$ref": "#/definitions/rg_fo"
                },
                "ID": {
                    "$ref": "#/definitions/rg_id"
                },
                "KS": {
                    "$ref": "#/definitions/rg_ks"
                },
                "LB": {
                    "$ref": "#/definitions/rg_lb"
                },
                "PG": {
                    "$ref": "#/definitions/rg_pg"
                },
                "PI": {
                    "$ref": "#/definitions/rg_pi"
                },
                "PL": {
                    "$ref": "#/definitions/rg_pl"
                },
                "PM": {
                    "$ref": "#/definitions/rg_pm"
                },
                "PU": {
                    "$ref": "#/definitions/rg_pu"
                },
                "SM": {
                    "$ref": "#/definitions/rg_sm"
                }
            }
        },
        "rg_cn": {
            "type": "string"
        },
        "rg_ds": {
            "type": "string"
        },
        "rg_dt": {
            "format": "date-time",
            "type": "string"
        },
        "rg_fo": {
            "type": "string"
        },
        "rg_id": {
            "type": "string"
        },
        "rg_ks": {
            "type": "string"
        },
        "rg_lb": {
            "type": "string"
        },
        "rg_pg": {
            "type": "string"
        },
        "rg_pi": {
            "type": "string"
        },
        "rg_pl": {
            "enum": [
                "UNKNOWN",
                "CAPILLARY",
                "LS454",
                "ILLUMINA",
                "SOLID",
                "HELICOS",
                "IONTORRENT",
                "ONT",
                "PACBIO"
            ],
            "type": "string"
        },
        "rg_pm": {
            "type": "string"
        },
        "rg_pu": {
            "type": "string"
        },
        "rg_sm": {
            "type": "string"
        },
        "segment_cardinality": {
            "minimum": 0,
            "type": "integer"
        },
        "segment_pattern": {
            "format": "regex",
            "pattern": "^(~)?[0-9]+(:(~)?[0-9]+)*$",
            "type": "string"
        },
        "segment_token": {
            "format": "regex",
            "pattern": "^[0-9]+:(-?[0-9]+)?:(-?[0-9]+)?$",
            "type": "string"
        },
        "shannon_bound": {
            "items": {
                "minimum": 0,
                "type": "integer"
            },
            "minItems": 1,
            "type": "array"
        },
        "threads": {
            "minimum": 1,
            "type": "integer"
        },
        "transform": {
            "properties": {
                "segment pattern": {
                    "items": {
                        "$ref": "#/definitions/segment_pattern"
                    },
                    "minItems": 1,
                    "type": "array"
                },
                "token": {
                    "items": {
                        "$ref": "#/definitions/segment_token"
                    },
                    "minItems": 1,
                    "type": "array"
                }
            },
            "required": [
                "token"
            ],
            "type": "object"
        },
        "url": {
            "oneOf": [
                {
                    "properties": {
                        "compression": {
                            "enum": [
                                "gz",
                                "bz2",
                                "xz"
                            ],
                            "type": "string"
                        },
                        "path": {
                            "type": "string"
                        },
                        "type": {
                            "enum": [
                                "fq",
                                "fastq",
                                "bam",
                                "cram",
                                "sam",
                                "json"
                            ],
                            "type": "string"
                        }
                    },
                    "required": [
                        "path"
                    ],
                    "type": "object"
                },
                {
                    "type": "string"
                }
            ]
        },
        "url_array": {
            "oneOf": [
                {
                    "$ref": "#/definitions/url"
                },
                {
                    "items": {
                        "$ref": "#/definitions/url"
                    },
                    "minItems": 1,
                    "type": "array"
                }
            ]
        }
    }
}
